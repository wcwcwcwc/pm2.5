<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>实时查询</title>
	<link rel="stylesheet" href="/static/css/ol.css" type="text/css"> 
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
	<script type="text/javascript" src="/static/script/vue.js"></script>
	<script type="text/javascript" src="/static/script/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="/static/script/bootstrap.js"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=sLhNBNxahD4oI7l2pynMW0SR6G4qyUtg"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
	<style type="text/css">
		.map{
			position: absolute;
			top:52px;
        	width:100%;
        	bottom: 0px;
        	left: 0px;
        	background: #FFF;
        }
        .BMap_mask{
        	background: #FFF;
        }
		
	</style>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="javascript:">Brand</a>
			</div>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li ><a href="/">首页 <span class="sr-only">(current)</span></a></li>
					<li><a href="/query">数据查询</a></li>
					<li class="dropdown">
						<a href="/analyze" class="dropdown-toggle active" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">数据分析<span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="javascript:">插值分析</a></li>
							<li role="separator" class="divider"></li>
							<li><a href="javascript:">变化趋势分析</a></li>
							<li><a href="javascript:">Something else here</a></li>
							<li role="separator" class="divider"></li>
							<li><a href="#">Separated link</a></li>
							<li role="separator" class="divider"></li>
							<li><a href="#">One more separated link</a></li>
						</ul>
					</li>
				</ul>
		        <div class="navbar-form navbar-left">
		        	<button id="btn" class="btn btn-default">IDW插值</button>
			    </div>
		    </div>
		</div>
	</nav>
	<div class="map" id="map">
<script>
	var jinan;
	
	var data=[{name:'机床二厂',lng:117.0006238,lat:36.66948298},{name:'济南化工厂',lng:117.001525,lat:36.69350392},{name:'开发区',lng:117.2119566,lat:36.79560411},{name:'长清党校',lng:116.7744603,lat:36.55667634},{name:'省种子仓库',lng:117.0649759,lat:36.6885423},{name:'市监测站',lng:116.998345,lat:36.64303627},{name:'农科所',lng:116.8784,lat:36.4814},{name:'科干所',lng:117.0049,lat:36.61202}];
	var coordinates=[[116.2244,36.1725],[116.2793,36.2219],[116.3232,36.2933],[116.4111,36.3208],[116.4331,36.3208],[116.4551,36.3428],[116.488,36.3428],[116.499,36.3757],[116.543,36.4087],[116.5979,36.4197],[116.6199,36.4307],[116.6089,36.4746],[116.5979,36.4856],[116.5979,36.4966],[116.6199,36.4966],[116.6309,36.5076],[116.6089,36.5186],[116.6089,36.524],[116.6309,36.546],[116.6528,36.5515],[116.6638,36.579],[116.6858,36.59],[116.6968,36.6064],[116.7517,36.6339],[116.7627,36.6504],[116.7737,36.6669],[116.7847,36.6943],[116.7957,36.6943],[116.8286,36.7218],[116.8616,36.7273],[116.8835,36.7438],[116.8616,36.7822],[116.8726,36.8042],[116.8835,36.8152],[116.8835,36.8262],[116.9165,36.8262],[116.9604,36.8427],[116.9604,36.9196],[116.9385,36.925],[116.9385,36.9415],[116.9165,36.958],[116.8945,36.9635],[116.8945,36.98],[116.8726,36.9965],[116.9165,37.0239],[116.9385,37.0349],[116.9165,37.0734],[116.9165,37.1008],[116.9385,37.1008],[116.9495,37.1118],[116.9824,37.1118],[116.9934,37.1283],[117.0374,37.1228],[117.0593,37.1613],[117.0593,37.1887],[117.0374,37.1997],[117.0374,37.2162],[117.0374,37.2382],[117.0374,37.2601],[117.0264,37.2766],[117.0044,37.2876],[116.9824,37.337],[116.9934,37.348],[117.0044,37.359],[117.0044,37.37],[116.9934,37.381],[117.0044,37.392],[117.0154,37.392],[117.0264,37.403],[117.0154,37.4194],[117.0154,37.4304],[117.0923,37.4414],[117.1033,37.4579],[117.1033,37.4689],[117.1033,37.4744],[117.1252,37.4854],[117.1472,37.4744],[117.1912,37.4854],[117.2241,37.5128],[117.2241,37.5403],[117.2571,37.5293],[117.2681,37.5403],[117.2681,37.5238],[117.2791,37.5183],[117.29,37.5073],[117.301,37.5073],[117.323,37.5018],[117.323,37.4908],[117.29,37.4854],[117.2791,37.4744],[117.301,37.4689],[117.312,37.4469],[117.334,37.4524],[117.3669,37.4469],[117.3669,37.4194],[117.3669,37.4139],[117.3669,37.403],[117.356,37.403],[117.3999,37.3865],[117.3999,37.3755],[117.4109,37.3645],[117.4109,37.3096],[117.4329,37.2821],[117.4219,37.2491],[117.3999,37.2327],[117.4219,37.1887],[117.4329,37.1942],[117.4438,37.1558],[117.4548,37.1338],[117.4548,37.1063],[117.4329,37.0898],[117.3999,37.0844],[117.3669,37.0734],[117.334,37.0734],[117.334,37.0404],[117.323,37.0294],[117.323,37.0129],[117.334,37.0074],[117.3669,37.002],[117.3779,36.958],[117.3889,36.9525],[117.4109,36.9525],[117.4219,36.969],[117.4219,36.9525],[117.4438,36.9525],[117.5098,36.969],[117.5098,36.9745],[117.5208,36.9635],[117.5427,36.9745],[117.5647,36.958],[117.5647,36.947],[117.5427,36.936],[117.5757,36.8976],[117.5757,36.8536],[117.5867,36.8481],[117.5977,36.8317],[117.6855,36.7877],[117.6965,36.7548],[117.7515,36.7493],[117.7405,36.7218],[117.7185,36.7053],[117.7185,36.6888],[117.7075,36.6888],[117.6965,36.6779],[117.6965,36.6504],[117.7075,36.6394],[117.7075,36.568],[117.7405,36.5405],[117.7405,36.524],[117.6965,36.5186],[117.6416,36.535],[117.6196,36.5515],[117.5867,36.5405],[117.5647,36.5131],[117.5208,36.5021],[117.4988,36.5076],[117.4988,36.4966],[117.4768,36.4746],[117.4109,36.4636],[117.3999,36.4417],[117.3779,36.4362],[117.356,36.4581],[117.345,36.4691],[117.312,36.4691],[117.29,36.4746],[117.2791,36.4526],[117.2461,36.4362],[117.2351,36.4142],[117.2021,36.3977],[117.2021,36.3922],[117.1692,36.3538],[117.1472,36.3483],[117.1252,36.3373],[117.0923,36.3428],[117.0703,36.3153],[117.0813,36.2988],[117.0264,36.2823],[117.0264,36.2714],[117.0044,36.2659],[116.9824,36.2439],[116.9495,36.2604],[116.9165,36.2659],[116.8945,36.2549],[116.8726,36.2659],[116.8616,36.2823],[116.8506,36.2933],[116.8176,36.2988],[116.7737,36.3153],[116.7407,36.3043],[116.7188,36.2823],[116.7078,36.2878],[116.6858,36.2769],[116.6528,36.2988],[116.6089,36.2933],[116.5979,36.2714],[116.554,36.2494],[116.51,36.2549],[116.4771,36.2109],[116.51,36.178],[116.532,36.1725],[116.532,36.1505],[116.554,36.134],[116.5649,36.1121],[116.543,36.1066],[116.543,36.0846],[116.532,36.0681],[116.499,36.0736],[116.488,36.0681],[116.4441,36.0571],[116.4331,36.0571],[116.4331,36.0681],[116.4111,36.0736],[116.4001,36.0846],[116.3672,36.0901],[116.3562,36.0846],[116.3562,36.0736],[116.3452,36.0626],[116.3123,36.0516],[116.3013,36.0297],[116.2793,36.0406],[116.2573,36.0681],[116.2573,36.1011],[116.2683,36.123],[116.2244,36.1725]];
	var coo=[[117.996086115,37.0374007229],[118.001759502,37.0368838824
],[118.000718773,37.0289914864],[117.994845391,37.0293002611
]];
	var dValue=[];
	var min_maxCoordinate=getMax_Min(coo);
	console.log (min_maxCoordinate);
	var heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":2});
	// 百度地图API功能
	var map = new BMap.Map("map");    // 创建Map实例
	map.centerAndZoom(new BMap.Point(117.99614139100005,37.02979648639996), 16);  // 初始化地图,设置中心点坐标和地图级别
	map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
	map.setCurrentCity("淄博");          // 设置地图显示的城市 此项是必须设置的
	map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
	/*map.addEventListener("zoomend", function() {
		//radius=radius*3;
		//alert(this.getZoom());
		map.removeOverlay(heatmapOverlay);
		dValue=getDvaule();
         //console.log(dValue);
        doIdw(min_maxCoordinate,dValue);

	});*/
	function getMax_Min(coordinates){
		var maxlng=coordinates[0][0];
		var maxLat=coordinates[0][1];
		var minlng=coordinates[0][0];
		var minLat=coordinates[0][1];
		for(var i=1;i<coordinates.length;i++){
			if(coordinates[i][0]>maxlng){
				maxlng=coordinates[i][0];
			}
			if(coordinates[i][0]<minlng){
				minlng=coordinates[i][0];
			}
			if(coordinates[i][1]>maxLat){
				maxLat=coordinates[i][1];
			}
			if(coordinates[i][1]<minLat){
				minLat=coordinates[i][1];
			}
		}
		return {"min":[minlng,minLat],"max":[maxlng,maxLat]}
	}
	
	console.log(min_maxCoordinate);
	function doIdw(min_maxCoordinate,dValue){
		var minlng=min_maxCoordinate.min[0];
		var minLat=min_maxCoordinate.min[1];
		var maxlng=min_maxCoordinate.max[0];
		var maxLat=min_maxCoordinate.max[1];
		//console.log(minLat);
		//console.log(maxLat);
		var lng=[];
		var lat=[];
		var pointsData=[];
		var idwData=[];
		var heatmapData=[];
		var dlng=dValue[0];
		var dlat=dValue[1];
		var a=[];
		while(minlng<maxlng){
			minlng+=dlng;
			lng.push(minlng);
		}
		while(minLat<maxLat){
			minLat+=dlat;
			lat.push(minLat);
		}
		//console.log(lng);
		//console.log(lat);
		for(var i=0;i<lng.length;i++){
			for(var j=0;j<lat.length;j++){
				if(IsPtInPoly([lng[i],lat[j]],coo)){
					idwData.push(idw([lng[i],lat[j]]));
					pointsData.push([lng[i],lat[j]]);
					heatmapData.push([lng[i],lat[i],idw([lng[i],lat[j]])]);
				}	
			}
		}
	
		heatmap(idwData,pointsData);
	}
	//heatmap
	function heatmap(idwData,pointsData){
		var a=normalization(idwData);
		//console.log(idwData);
		if(!isSupportCanvas()){
    		alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
	    }
	    var points=[];
		var point={};
	    for(var i=0;i<idwData.length;i++){
			    	point={"lng":pointsData[i][0],"lat":pointsData[i][1],"count":a[i]};
			    	points.push(point);
			    }
		console.log(points);
	    //var point={};
		//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
		//参数说明如下:
		/* visible 热力图是否显示,默认为true
	     * opacity 热力的透明度,1-100
	     * radius 势力图的每个点的半径大小   
	     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
	     *	{
				.2:'rgb(0, 255, 255)',
				.5:'rgb(0, 110, 255)',
				.8:'rgb(100, 0, 255)'
			}
			其中 key 表示插值的位置, 0~1. 
			    value 为颜色值. 
	     */
	    //console.log(points);
		map.addOverlay(heatmapOverlay);
		heatmapOverlay.setDataSet({data:points,max:1.2});
		setGradient();
		//显示热力图
	    //heatmapOverlay.show();
	    function setGradient(){
	     	/*格式如下所示:
			{
		  		0:'rgb(102, 255, 0)',
		 	 	.5:'rgb(255, 170, 0)',
			  	1:'rgb(255, 0, 0)'
			}*/
	     	var gradient = {
	     		.1:'rgb(0,255,255)',
	     		.2:'rgb(0,153,255)',
	     		.3:'rgb(0,51,255)',
	     		.4:'rgb(15,240,0)',
		  		.5:'rgb(102, 255, 0)',
		 	 	.6:'rgb(204,255,0)',
		 	 	.7:'rgb(255,255,0)',
		 	 	.8:'rgb(255,153,0)',
		 	 	.9:'rgb(255,102,0)',
			  	1:'rgb(255, 51, 0)'
			};
	     	var colors = document.querySelectorAll("input[type='color']");
	     	colors = [].slice.call(colors,0);
	     	colors.forEach(function(ele){
				gradient[ele.getAttribute("data-key")] = ele.value; 
	     	});
	        heatmapOverlay.setOptions({"gradient":gradient});
	    }
		//判断浏览区是否支持canvas
	    function isSupportCanvas(){
	        var elem = document.createElement('canvas');
	        return !!(elem.getContext && elem.getContext('2d'));
	    }
	}
	function normalization(data){
		var max=61;
		var min=28.6;
		var a=max-min;
		for(var i=0;i<data.length;i++){
			data[i]=((data[i]-min)/a)+0.2;

		}
		return data;
	}

	//判断点在多边形内
	function IsPtInPoly(point, APoints) {  
	    var iSum = 0,  
	        iCount;  
	    var dlng1, dlng2, dLat1, dLat2, dlng;
	    var Alng=point[0];
	    var ALat=point[1];  
	    if (APoints.length < 3) return false;  
	    iCount = APoints.length;  
	    for (var i = 0; i < iCount; i++) {  
	        if (i == iCount - 1) {  
	            dlng1 = APoints[i][0];  
	            dLat1 = APoints[i][1];  
	            dlng2 = APoints[0][0];  
	            dLat2 = APoints[0][1];  
	        } else {  
	            dlng1 = APoints[i][0];  
	            dLat1 = APoints[i][1];  
	            dlng2 = APoints[i + 1][0];  
	            dLat2 = APoints[i + 1][1];  
	        }  
	        //以下语句判断A点是否在边的两端点的水平平行线之间，在则可能有交点，开始判断交点是否在左射线上  
	        if (((ALat >= dLat1) && (ALat < dLat2)) || ((ALat >= dLat2) && (ALat < dLat1))) {  
	            if (Math.abs(dLat1 - dLat2) > 0) {  
	                //得到 A点向左射线与边的交点的x坐标：  
	                dlng = dlng1 - ((dlng1 - dlng2) * (dLat1 - ALat)) / (dLat1 - dLat2);  
	                if (dlng < Alng)  
	                    iSum++;  
	            }  
	        }  
	    }  
	    if (iSum % 2 != 0)  
	        return true;  
	    return false;  
	} 
	//#btn点击todo;
	$('#btn').on('click',function(e){
		
         dValue=getDvaule();
         //console.log(dValue);
         doIdw(min_maxCoordinate,dValue);
         console.log('do');
       
    });
    /*function test(){
		var data=[];
		var points=[[117.0006238,36.66948298],[117.001525,36.69350392],[117.2119566,36.79560411],[116.7744603,36.55667634],[117.0649759,36.6885423],[116.998345,36.64303627],[116.8784,36.4814],[117.0049,36.61202]];
		for(var i=0;i<points.length;i++){
			
			data.push(map.getPixelFromCoordinate(ol.proj.transform(points[i], 'EPSG:4326','EPSG:3857')));
		}
		console.log(data);
	}*/
	
	var points=[[117.0006238,36.66948298],[117.001525,36.69350392],[117.2119566,36.79560411],[116.7744603,36.55667634],[117.0649759,36.6885423],[116.998345,36.64303627],[116.8784,36.4814],[117.0049,36.61202]];
	function getDvaule(){
		var dValue=[];
		var p1=new BMap.Pixel(100,100); 
		var p2=new BMap.Pixel(101,101);
        var a=map.pixelToPoint(p1);
        var b=map.pixelToPoint(p2);
        //console.log(a);
        dValue[0]=Math.abs(b.lng-a.lng);
        dValue[1]=Math.abs(b.lat-a.lat);
        //console.log(dValue);
        return dValue;
	}
	function getDistance(point,points){
		var pointA = new BMap.Point(point[0],point[1]);
		var pointB = new BMap.Point(points[0],points[1]);
		var dis=map.getDistance(pointA,pointB)
		return dis;
	}
	function idw(point){
		var wi;
		var dis;
		var zi;
		var sumwi=0;
		var sumzi=0;
		var points=[
{"lng":"117.9960861150 ","lat":"37.0374007229 ","count":"49.40 "},
{"lng":"117.9960413430 ","lat":"37.0369092581 ","count":"52.50 "},
{"lng":"117.9959965710 ","lat":"37.0364177932 ","count":"49"},
{"lng":"117.9959517990 ","lat":"37.0359263283 ","count":"53.8"},
{"lng":"117.9958703","lat":"37.03548222","count":"43.7"},
{"lng":"117.9958622550 ","lat":"37.0349433986 ","count":"48.8"},
{"lng":"117.9958174830 ","lat":"37.0344519337 ","count":"49.6"},
{"lng":"117.9957727110 ","lat":"37.0339604688 ","count":"50.9"},
{"lng":"117.9957279390 ","lat":"37.0334690040 ","count":"56.2"},
{"lng":"117.9964371130 ","lat":"37.0334043989 ","count":"53.5"},
{"lng":"117.9964818850 ","lat":"37.0338958638 ","count":"52.7"},
{"lng":"117.9965266570 ","lat":"37.0343873286 ","count":"49.8"},
{"lng":"117.9965714290 ","lat":"37.0348787935 ","count":"46.8"},
{"lng":"117.9966162010 ","lat":"37.0353702584 ","count":"55.5"},
{"lng":"117.9966609730 ","lat":"37.0358617232 ","count":"51.2"},
{"lng":"117.9967057450 ","lat":"37.0363531881 ","count":"54.9"},
{"lng":"117.9967505170 ","lat":"37.0368446530 ","count":"52.4"},
{"lng":"117.9967952890 ","lat":"37.0373361178 ","count":"49.6"},
{"lng":"117.9975044620 ","lat":"37.0372715128 ","count":"46.7"},
{"lng":"117.9974596900 ","lat":"37.0367800479 ","count":"53.1"},
{"lng":"117.9974149180 ","lat":"37.0362885830 ","count":"53.9"},
{"lng":"117.9973701460 ","lat":"37.0357971182 ","count":"51.5"},
{"lng":"117.9973253740 ","lat":"37.0353056533 ","count":"57"},
{"lng":"117.9972806020 ","lat":"37.0348141884 ","count":"53.1"},
{"lng":"117.9972358300 ","lat":"37.0343227236 ","count":"54"},
{"lng":"117.9971910580 ","lat":"37.0338312587 ","count":"54.8"},
{"lng":"117.9971462860 ","lat":"37.0333397938 ","count":"52.8"},
{"lng":"117.9980345470 ","lat":"37.0352410482 ","count":"54.9"},
{"lng":"117.9980793190 ","lat":"37.0357325131 ","count":"54.3"},
{"lng":"117.9981240910 ","lat":"37.0362239780 ","count":"54.9"},
{"lng":"117.9981688630 ","lat":"37.0367154428 ","count":"56"},
{"lng":"117.9982136350 ","lat":"37.0372069077 ","count":"56.4"},
{"lng":"117.9989228090 ","lat":"37.0371423026 ","count":"52.7"},
{"lng":"117.9988780370 ","lat":"37.0366508378 ","count":"57.2"},
{"lng":"117.9988332650 ","lat":"37.0361593729 ","count":"55.2"},
{"lng":"117.9987884930 ","lat":"37.0356679080 ","count":"56.2"},
{"lng":"117.9987437210 ","lat":"37.0351764432 ","count":"53.4"},
{"lng":"117.9979897750 ","lat":"37.0347495834 ","count":"45.3"},
{"lng":"117.9979450030 ","lat":"37.0342581185 ","count":"52.3"},
{"lng":"117.9979002310 ","lat":"37.0337666536 ","count":"56.2"},
{"lng":"117.9978554590 ","lat":"37.0332751888 ","count":"43.9"},
{"lng":"117.9983405740 ","lat":"37.0333991211 ","count":"51.7"},
{"lng":"117.9983140440 ","lat":"37.0331169355 ","count":"54.1"},
{"lng":"117.9985450250 ","lat":"37.0330952193 ","count":"46.9"},
{"lng":"117.9987760070 ","lat":"37.0330735031 ","count":"47.7"},
{"lng":"117.9988025370 ","lat":"37.0333556887 ","count":"51.8"},
{"lng":"117.9985715560 ","lat":"37.0333774049 ","count":"44.5"},
{"lng":"117.9983671040 ","lat":"37.0336813067 ","count":"46.3"},
{"lng":"117.9985980860 ","lat":"37.0336595905 ","count":"51.1"},
{"lng":"117.9988290670 ","lat":"37.0336378743 ","count":"47.6"},
{"lng":"117.9988555980 ","lat":"37.0339200599 ","count":"56"},
{"lng":"117.9986246160 ","lat":"37.0339417761 ","count":"48.7"},
{"lng":"117.9983936350 ","lat":"37.0339634923 ","count":"49.3"},
{"lng":"117.9984201650 ","lat":"37.0342456779 ","count":"51.8"},
{"lng":"117.9986511460 ","lat":"37.0342239617 ","count":"53.4"},
{"lng":"117.9988821280 ","lat":"37.0342022455 ","count":"46.9"},
{"lng":"117.9989086580 ","lat":"37.0344844311 ","count":"51.6"},
{"lng":"117.9986776770 ","lat":"37.0345061473 ","count":"48.4"},
{"lng":"117.9984466950 ","lat":"37.0345278635 ","count":"54"},
{"lng":"117.9984732260 ","lat":"37.0348100491 ","count":"55.6"},
{"lng":"117.9989351880 ","lat":"37.0347666167 ","count":"46.5"},
{"lng":"117.9987042070 ","lat":"37.0347883329 ","count":"56.9"},
{"lng":"117.9994081220 ","lat":"37.0346203732 ","count":"52.5"},
{"lng":"117.9993633500 ","lat":"37.0341289084 ","count":"43.8"},
{"lng":"117.9993185780 ","lat":"37.0336374435 ","count":"47.6"},
{"lng":"117.9992738060 ","lat":"37.0331459786 ","count":"50"},
{"lng":"117.9999829790 ","lat":"37.0330813736 ","count":"42.2"},
{"lng":"118.0000277510 ","lat":"37.0335728384 ","count":"51.1"},
{"lng":"118.0000725230 ","lat":"37.0340643033 ","count":"46.1"},
{"lng":"118.0001172950 ","lat":"37.0345557682 ","count":"56.2"},
{"lng":"117.9994127778 ","lat":"37.0351066667 ","count":"39.6"},
{"lng":"117.9994976660 ","lat":"37.0356033030 ","count":"57.7"},
{"lng":"117.9995424380 ","lat":"37.0360947678 ","count":"56.2"},
{"lng":"117.9995872100 ","lat":"37.0365862327 ","count":"57.6"},
{"lng":"117.9996319820 ","lat":"37.0370776976 ","count":"56"},
{"lng":"118.0003411550 ","lat":"37.0370130925 ","count":"53.7"},
{"lng":"118.0002963830 ","lat":"37.0365216276 ","count":"52.1"},
{"lng":"118.0002516110 ","lat":"37.0360301628 ","count":"55.6"},
{"lng":"118.0002068390 ","lat":"37.0355386979 ","count":"45.8"},
{"lng":"118.0001620670 ","lat":"37.0350472330 ","count":"58"},
{"lng":"118.0008264690 ","lat":"37.0344911631 ","count":"51.9"},
{"lng":"118.0007816970 ","lat":"37.0339996982 ","count":"53.4"},
{"lng":"118.0007369250 ","lat":"37.0335082333 ","count":"55.2"},
{"lng":"118.0006921530 ","lat":"37.0330167685 ","count":"55.6"},
{"lng":"118.0014013260 ","lat":"37.0329521634 ","count":"51.9"},
{"lng":"118.0014460980 ","lat":"37.0334436283 ","count":"58.6"},
{"lng":"118.0014908700 ","lat":"37.0339350931 ","count":"54.3"},
{"lng":"118.0015356420 ","lat":"37.0344265580 ","count":"48.6"},
{"lng":"118.0015804140 ","lat":"37.0349180229 ","count":"58.2"},
{"lng":"118.0016251860 ","lat":"37.0354094877 ","count":"56.7"},
{"lng":"118.0016699580 ","lat":"37.0359009526 ","count":"55.8"},
{"lng":"118.0017147300 ","lat":"37.0363924175 ","count":"56.7"},
{"lng":"118.0017595020 ","lat":"37.0368838824 ","count":"56"},
{"lng":"118.0010503290 ","lat":"37.0369484874 ","count":"51.9"},
{"lng":"118.0010055570 ","lat":"37.0364570226 ","count":"53.6"},
{"lng":"118.0009607850 ","lat":"37.0359655577 ","count":"54.4"},
{"lng":"118.0009160130 ","lat":"37.0354740928 ","count":"55.4"},
{"lng":"118.0008712410 ","lat":"37.0349826280 ","count":"52.6"},
{"lng":"117.9954640510 ","lat":"37.0323650069 ","count":"43.6"},
{"lng":"117.9952641760 ","lat":"37.0313656333 ","count":"44.5"},
{"lng":"117.9950452660 ","lat":"37.0302139742 ","count":"46.2"},
{"lng":"117.9948453910 ","lat":"37.0293002611 ","count":"48.7"},
{"lng":"117.9965878700 ","lat":"37.0293181071 ","count":"51"},
{"lng":"117.9966925670 ","lat":"37.0301556774 ","count":"50.2"},
{"lng":"117.9968734060 ","lat":"37.0312311937 ","count":"49"},
{"lng":"117.9970447270 ","lat":"37.0321924960 ","count":"50.3"},
{"lng":"117.9991959180 ","lat":"37.0320866893 ","count":"51.5"},
{"lng":"117.9990245970 ","lat":"37.0311253870 ","count":"51.4"},
{"lng":"117.9988437580 ","lat":"37.0300498707 ","count":"44.5"},
{"lng":"117.9987390620 ","lat":"37.0292123004 ","count":"46.2"},
{"lng":"118.0007187730 ","lat":"37.0289914864 ","count":"53.3"},
{"lng":"118.0008234700 ","lat":"37.0298290567 ","count":"44.9"},
{"lng":"118.0010043090 ","lat":"37.0309045730 ","count":"49.8"},
{"lng":"118.0011756300 ","lat":"37.0318658753 ","count":"51.4"},

]
		for(var i=0;i<points.length;i++){
			dis=getDistance(point,[points[i].lng,[points[i].lat]]);
			wi=1/(Math.pow(dis,2));
			zi=wi*points[i].count;
			sumwi=sumwi+wi;
			sumzi=sumzi+zi;
		}
		var pm25=sumzi/sumwi;
		//console.log(pm25);
		return pm25;
	}
	//var b=map.getCoordinateFromPixel([401,401]);
	/*map.getView().on('change:resolution', function(evt){
		console.log(map.getEventCoordinate(jinan));
	})
	map.addEventListener("click",function(evt){
		var pixel = map.getEventPixel(evt.originalEvent);
		console.log(pixel);
		//alert(map.getCoordinateFromPixel([755,262]));
		var coordinate = evt.coordinate;
		var hdms = ol.proj.transform(  
		      coordinate, 'EPSG:3857', 'EPSG:4326');
		var point=[hdms[0],hdms[1]];
		alert(IsPtInPoly(point,coordinates));
		idw(point);
	});*/
	
</script>
</body>
</html>